{{% extends 'base.html' %}

{% block content %}
    <h1>Lista de Agendamentos</h1>

    <!-- Formulário para filtro -->
    <form method="get">
        <div class="form-group">
            <label for="date_start">Data Início:</label>
            <input type="date" name="date_start" id="date_start" class="form-control" value="{{ request.GET.date_start }}">
        </div>
        <div class="form-group">
            <label for="date_finish">Data Fim:</label>
            <input type="date" name="date_finish" id="date_finish" class="form-control" value="{{ request.GET.date_finish }}">
        </div>
        <div class="form-group">
            <label for="technician">Técnico:</label>
            <select name="technician" id="technician" class="form-control">
                <option value="">Todos os Técnicos</option>
                {% for tech in technicians %}
                    <option value="{{ tech.technician__id }}" 
                        {% if tech.technician__id|stringformat:"s" == request.GET.technician %}
                            selected
                        {% endif %}
                    >
                        {{ tech.technician__name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{% url 'workingdays_list' %}" class="btn btn-secondary">Limpar Filtros</a>
    </form>
    <br>

    {% if workingdays %}
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Técnico</th>
                    <th>Cliente</th>
                    <th>Serviço</th>
                    <th>Data Início</th>
                    <th>Data Término</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for workingday in workingdays %}
                <tr>
                    <td>{{ workingday.technician }}</td>
                    <td>{{ workingday.customer }}</td>
                    <td>{{ workingday.service }}</td>
                    <td>{{ workingday.date_start }}</td>
                    <td>{{ workingday.date_finish }}</td>
                    <td>{{ workingday.is_working|yesno:"Trabalhando,Livre" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Não há agendamentos cadastrados.</p>
    {% endif %}
{% include 'components/_pagination.html' %}
{% endblock %}
